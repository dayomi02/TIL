

## Memory System

- 컴퓨터 프로그램의 작업공간
- 프로그램과 데이터의 영구적인 저장공간
- 휘발성 메모리
정보 유지를 위해 지속적인 전력 공급을 필요로 함.
일반 목적의 RAM의 대부분은 휘발성이다.
- 비휘발성 메모리
지속적인 전력 공급을 요구하지 않는다.
ROM, Flash메모리 등

---

- 메모리의 추상화
    - 가상 flat 메모리 공간
        - 애플리케이션 관점에서 단일 논리 주소 공간.
        - 이상적인 메모리 가정 : 1 CPU 클럭의 어느 위치를 읽고/쓴다.

    ⇒ CPU가 1클럭당 사용할 수 있는 메모리 공간의 크기

    32bit는 4GB의 메모리 공간을 한번에 접근 가능하다.

- 실행
    - 단일 유형의 메모리 장치로를 구현 불가능.
    - 잘 구현된 **"메모리 계층 구조"**
    - 일련의 메모리 서브 시스템으로 구성됨.
        - Caches, DRAMs, Disks, Tapes, 분산 파일 시스템 등

    CUP 레지스터 → Cach → DRAMs → Disks → Tapes

## Memory Hierarchy

- 목표 : 속도와 용량을 동시에 달성
    - 속도 : 가장 빠른 구성 요소의 성능 제공
    - 용량 :  가장 저렴한 구성요소의 비용으로

    ⇒ 둘을 동시에 확보하는 것은 불가능

- 기준의 위치
    - 메모리 계층 설계의 핵심
        - Temporal Locality (시간 지역성)
        하나의 메모리 위치가 참조되면 가까운 시일 내에 다시 참조될 가능성이 높다.
        - Sparial Locality (공간 지역성)
        하나의 메모리 위치가 참조되는 인접 메모리 위치가 가까울 때 참조될 가능성이 높다.

---

계층 구조에서 작업을 하는 도중, 에러가 났을 경우, 메인 메모리에서 데이터를 가지고 올 때 계층에서의 가질 수 있는 모든 메모리를 가지고 온다.

이것이 시간 지역성, 공간 지역성과 관련이 있다.

## SRAM (Static RAM)

- 4T 또는 6T 구조 ( T = transistor )
- 휘발성

    전원이 공급되지 않으면 데이터가 손실된다.

- 안정적
전원이 인가되는 한 가치를 유지한다.
- 매우 빠름 (~ 수십ns)
L1 및 L2 캐시에 적합
- 매우 비쌈
일반적인 크기 범위 : 수십 KB ~ 여러 MB

## DRAM (Dynamic RAM)

- 1T 1C 구조 ( T = transistor, C = capacitor(콘덴서))
전하가 서서히 누출됨
SRAM 보다 종일 면적대비 확보할 수 있는 용량이 훨씬 많기 때문에 capacitor에 있지만 서서히 방전된다.
- 휘발성
전원이 공급되지 않을 때 데이터 손실
- 불안정
주기적으로 refresh 하지 않을 경우 데이터 손실
- 파괴적 읽기 (읽기에 의해 소모되는 전하)
읽은 후에 다시 작성해야 한다.
파괴적 읽기 : 읽는 순간 데이터는 사라진다. 따라서 읽는 값을 다시 적어줘야 한다.
- 빠름 (~ 수백 ns)
메인 메모리에 적합
수GB 단위이기 때문에 사이즈를 쪼개서 접근을 한다. 그 과정에서 속도가 수백 ns까지 올라간다.
- 매우 비쌈
SRAM 보다는 싸다.
일반적인 크기 범위 : 여러 GB

## Flash Memory

- 운영원칙
플로팅 게이크에 갇힌 전자
- 비휘발성
전자가 전원 공급 없이 유지됨
고전압 공급 시 제거 가능 (지우기 작동)
- 읽기/쓰기 단위 (프로그램)
page (1KB ~ 4KB)
- 소거 장치
수십 page 차단(ex. 64page)

⇒ 읽고 쓰는 것은 page단위로 실행되지만, 지우는 것은 페이지 블록으로 처리.

- 외부 업데이트
삭제 전 쓰기 제약 조건
가비지 수집 필요

## Multi-Level Cell Flash

- 셀당 2비트 이상 저장
저장될 충전량에 대한 세분화된 제어
- 특징
    - 비트당 비용 절감
    - 느린 프로그램 속도
    - 느린 읽기 속도
    - 쓰기 내구성 감소
    - 데이터 보존 시간 단축



## Cache Memory

- 작은 사이즈 & 고속 메모리
자주 사용하는 데이터의 일부 저장
- 캐시에 설치된 대부분의 메모리 접속(액세스)
    - 평균 메모리 액세스 시간 단축
    - 시간적 & 공간적 지역 활동


느린 Bus와 메인 메모리는 성능 병목 현상이 된다. 

캐시를 구축하면 성능 병목 현상을 크게 줄일 수 있다.

## Cache Performance

- 설계 목표
CPU에 가능한 빨리 명령 및 데이터를 제공하기 위해서
- Cache Hit
    - 캐시에서 요청된 데이터 발견
    - Hit Time : 캐시의 데이터에 대한 액세스 대기 시간
- Cache Miss
    - 요청된 데이터를 캐시에서 찾을 수 없는 경우
    - Miss penalty : 기본 메모리에서 누락된 캐시 라인을 가져오는 데 걸리는 시간
- 평균 액세스 시간
Access time = (Hit time) + (Miss rate) x (miss penalty)

## Cache Writing Policy

- Write hit
    - Write through
    쓰기는 캐시와 메인 메모리에 모두 수행된다.
    ⇒ write를 하고 바로 storage에 보내는 것
    - Write back
    쓰기는 캐시에만 수행된다.
    관련 캐시 블록이 캐시에서 제거되면 기본 메모리가 없데이트된다.
    ⇒ 캐시에만 미리 적어놓고 시간을 가진 뒤 한계가 됐을 때 storage에 write하는 것
- Write miss
    - Write allocate
    누락된 캐시 블록을 먼저 캐시에 로드된 후 Write-hit 작업을 수행한다.
    - No-write allocate
    누락된 캐시 블록은 캐시에 로드되지 않는다.
    데이터는 메인 메모리에 직접 기록된다.

## MMU (Memory Management Unit)

- 주소 번역

    가상 메모리 주소를 물리 메모리 주소로 변환.

- 메모리 보호

    프로세스가 할당되지 않은 메모리에 액세스하지 못하도록 하기 위해.
    프로세스가 원치 않은 메모리 영역에 접근하는 것을 방지한다.

## I/O Devices

- 기억장치와 유사함

    주소 버스, 데이터 버스 및 제어 신호의 사용

- I/O mapped I/O

    I/O 장치를 위한 전용 주소 공간
    Ex) Intel X86

- Memory-mapped I/O

    메모리 및 I/O 장치 모두에 대해 동일한 주소 버스

    일반적으로 대부분의 임베디드 프로세서에 사용

    주의

    - I/O 메모리 영역을 "non-cacheable" 영역으로 구성해야함
    - I/O 변수는 "휘발성"으로 선언해야함.

## I/O Resource Management

- Polling
    - I/O 장치의 준비 상태를 동기식으로 지속적으로 점검.
    - CPU는 기다리는 것 외에는 아무 작업도 하지 않는다. (busy-wait)
- Interrupt
    - I/O 장치가 준비 상태를 위한 신호를 보낼 수 있도록 허용
    - CPU가 다른 프로세스를 실행할 수 있음
- DMA (Direct Memory Access)
    - CPU의 개입 없이 I/O 장치와 메모리 간 데이터 전송

## Interrupt Interface

- Interrupt controller

    I/O 장치의 인터럽트 요청 관리




## Interrupt Vector

- Interrupt Vector Table
인터럽트 핸들러 기능을 인터럽트 요청에 연결하기 위한 정보를 저장하는 메모리 공간
- Fixed Interrupt
인터럽트 핸들러의 주소가 고정되어 있다.
- Vectored Interrupt
인터럽트 핸들러 주소는 구성할 수 있다.
I/O 장치로 설정 가능

## DMA (Direct Memory Access)

CPU의 개입 없이 I/O 디바이스와 메모리 간에 데이터를 전송할 수 있음


## Bus

- 컴퓨터 시스템의 구성요소가 공유하는 신호 집합
- 구성요소 간에 주소, 데이터 및 제어 정보를 전송하는데 사용
- address(주소) 버스, data(데이터) 버스, control(제어) 버스로 구성됨

